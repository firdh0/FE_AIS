<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link rel="icon" type="image/x-icon" href="../assets/logo.png">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/utilities.css" />
    <link rel="stylesheet" href="../css/sidebar.css">
    <link rel="stylesheet" href="../css/transactions.css" />

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet" />

    <!-- Jquery -->
    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
        integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>


    <title>Riwayat Pembelian</title>
</head>

<body>
    <div id="loading-effect" class="position-absolute w-100 vh-100">
        <div class="position-absolute top-50 start-50">
            <div class="loader" role="status"></div>
        </div>
    </div>
    <!-- Transactions -->
    <section class="transactions overflow-auto">
        <section class="sidebar">
            <div class="content pt-50 pb-30 ps-30">
                <div class="user text-center pb-50 pe-30">
                    <img src="../assets/img/avatar-1.png" width="90" height="90" class="img-fluid mb-20" />
                    <h2 id="user-nama" class="fw-bold text-xl color-palette-1 m-0"></h2>
                    <p id="user-email" class="color-palette-2 m-0"></p>
                </div>
                <div class="menus">
                    <div class="item active mb-30">
                        <svg class="icon me-3" width="25" height="25" viewBox="0 0 25 25" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M6.90332 2.41406L3.90332 6.41406V20.4141C3.90332 20.9445 4.11403 21.4532 4.48911 21.8283C4.86418 22.2033 5.37289 22.4141 5.90332 22.4141H19.9033C20.4338 22.4141 20.9425 22.2033 21.3175 21.8283C21.6926 21.4532 21.9033 20.9445 21.9033 20.4141V6.41406L18.9033 2.41406H6.90332Z"
                                stroke="#7E8CAC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path
                                d="M16.9033 10.4141C16.9033 11.4749 16.4819 12.4923 15.7317 13.2425C14.9816 13.9926 13.9642 14.4141 12.9033 14.4141C11.8425 14.4141 10.825 13.9926 10.0749 13.2425C9.32475 12.4923 8.90332 11.4749 8.90332 10.4141"
                                stroke="#7E8CAC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M3.90332 6.41406H21.9033" stroke="#7E8CAC" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        <p class="item-title m-0">
                            <a href="" class="text-lg text-decoration-none">Riwayat Pembelian</a>
                        </p>
                    </div>
                    <div class="item mb-30">
                        <svg class="icon me-3" width="25" height="25" viewBox="0 0 25 25" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0)">
                                <path
                                    d="M12.9033 15.4141C16.7693 15.4141 19.9033 12.2801 19.9033 8.41406C19.9033 4.54807 16.7693 1.41406 12.9033 1.41406C9.03733 1.41406 5.90332 4.54807 5.90332 8.41406C5.90332 12.2801 9.03733 15.4141 12.9033 15.4141Z"
                                    stroke="#7E8CAC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <path
                                    d="M9.11332 14.3039L7.90332 23.4139L12.9033 20.4139L17.9033 23.4139L16.6933 14.2939"
                                    stroke="#7E8CAC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </g>
                            <defs>
                                <clipPath id="clip0">
                                    <rect width="24" height="24" fill="white" transform="translate(0.90332 0.414062)" />
                                </clipPath>
                            </defs>
                        </svg>
                        <p class="item-title m-0">
                            <a href="./paketsaya.html" class="text-lg text-decoration-none">Paket Saya</a>
                        </p>
                    </div>
                    <div class="item mb-30">
                        <svg class="icon me-3" width="25" height="25" viewBox="0 0 25 25" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0)">
                                <path
                                    d="M12.9033 15.4141C16.7693 15.4141 19.9033 12.2801 19.9033 8.41406C19.9033 4.54807 16.7693 1.41406 12.9033 1.41406C9.03733 1.41406 5.90332 4.54807 5.90332 8.41406C5.90332 12.2801 9.03733 15.4141 12.9033 15.4141Z"
                                    stroke="#7E8CAC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <path
                                    d="M9.11332 14.3039L7.90332 23.4139L12.9033 20.4139L17.9033 23.4139L16.6933 14.2939"
                                    stroke="#7E8CAC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </g>
                            <defs>
                                <clipPath id="clip0">
                                    <rect width="24" height="24" fill="white" transform="translate(0.90332 0.414062)" />
                                </clipPath>
                            </defs>
                        </svg>
                        <p class="item-title m-0">
                            <a href="./belipaket.html" class="text-lg text-decoration-none">Beli Paket</a>
                        </p>
                    </div>
                    <div class="item mb-30">
                        <svg class="icon me-3" width="25" height="25" viewBox="0 0 25 25" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M19.2634 7.05396C20.5218 8.31274 21.3787 9.9164 21.7257 11.6621C22.0728 13.4079 21.8944 15.2173 21.2131 16.8617C20.5318 18.5061 19.3782 19.9115 17.8983 20.9003C16.4183 21.8891 14.6783 22.4169 12.8984 22.4169C11.1185 22.4169 9.37859 21.8891 7.89861 20.9003C6.41864 19.9115 5.26508 18.5061 4.58381 16.8617C3.90253 15.2173 3.72413 13.4079 4.07116 11.6621C4.41819 9.9164 5.27506 8.31274 6.53344 7.05396"
                                stroke="#7E8CAC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M12.9033 2.41406V12.4141" stroke="#7E8CAC" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        <p class="item-title m-0">
                            <a href="" id="keluar-button" class="text-lg text-decoration-none">Log Out</a>
                        </p>
                    </div>
                    <div class="sidebar-footer pt-73 pe-30">
                        <div class="footer-card">
                            <div class="d-flex justify-content-between mb-20">
                                <svg width="50" height="50" viewBox="0 0 50 50" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <mask id="mask0" mask-type="alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="50"
                                        height="50">
                                        <circle cx="25" cy="25" r="25" fill="#D7D7F8" />
                                    </mask>
                                    <g mask="url(#mask0)">
                                        <circle cx="25" cy="25" r="25" fill="#D7D7F8" />
                                        <rect x="8.125" y="15.625" width="33.75" height="38.125" rx="10" fill="#695DE9" />
                                        <path d="M31.25 28.75L31.25 42.5" stroke="white" stroke-width="2.5"
                                            stroke-linecap="round" stroke-linejoin="round" />
                                        <path d="M25 33.75L25 42.5" stroke="#B7B0F4" stroke-width="2.5"
                                            stroke-linecap="round" stroke-linejoin="round" />
                                        <path d="M18.75 37.5L18.75 42.5" stroke="#B7B0F4" stroke-width="2.5"
                                            stroke-linecap="round" stroke-linejoin="round" />
                                        <circle cx="25" cy="16.25" r="8.75" fill="#2B2467" />
                                        <path
                                            d="M24.4056 11.8294C24.5927 11.2536 25.4073 11.2536 25.5944 11.8294L26.2629 13.8868C26.3466 14.1443 26.5865 14.3186 26.8573 14.3186H29.0206C29.626 14.3186 29.8777 15.0934 29.3879 15.4493L27.6378 16.7208C27.4188 16.88 27.3271 17.1621 27.4108 17.4196L28.0792 19.477C28.2663 20.0528 27.6073 20.5316 27.1175 20.1757L25.3674 18.9042C25.1483 18.745 24.8517 18.745 24.6326 18.9042L22.8825 20.1757C22.3927 20.5316 21.7337 20.0528 21.9208 19.4769L22.5892 17.4196C22.6729 17.1621 22.5812 16.88 22.3622 16.7208L20.6121 15.4493C20.1223 15.0934 20.374 14.3186 20.9794 14.3186H23.1427C23.4135 14.3186 23.6534 14.1443 23.7371 13.8868L24.4056 11.8294Z"
                                            fill="white" />
                                    </g>
                                </svg>
                                <p class="fw-medium color-palette-1">Jangan lupa<br>
                                    Berlangganan</p>
                            </div>
                            <a class="btn btn-get-started w-100 fw-medium text-xs text-center text-white rounded-pill"
                                href="../src/paket.html" role="button">Beli Paket</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <main class="main-wrapper">
            <div class="ps-lg-0">
                <h2 class="text-4xl fw-bold color-palette-1 mb-30">Riwayat Pembelian</h2>
                <div class="row mt-30 mb-20">
                    <div class="col-lg-12 col-12 main-content">
                        <div id="list_status_title">
                            <a data-filter="*" href="#" class="btn btn-status rounded-pill text-sm btn-active me-3">All
                                Trx</a>
                            <a data-filter="success" href="#"
                                class="btn btn-status rounded-pill text-sm me-3">Sudah Bayar</a>
                            <a data-filter="failed" href="#" class="btn btn-status rounded-pill text-sm me-3">Belum bayar</a>
                        </div>
                    </div>
                </div>
                <div class="latest-transaction">
                    <p class="text-lg fw-medium color-palette-1 mb-14">Latest Transactions</p>
                    <div class="main-content main-content-table overflow-auto">
                        <table class="table table-borderless">
                            <thead>
                                <tr class="color-palette-1">
                                    <th class="" scope="col">Paket</th>
                                    <th scope="col">Harga</th>
                                    <th scope="col">Status</th>
                                    <th scope="col">Keterangan</th>
                                </tr>
                            </thead>
                            <tbody id="list_status_item">
                                <tr data-category="pending" class="align-middle">
                                    <th scope="row">
                                        <img class="float-start me-3 mb-lg-0 mb-3" src="https://images.unsplash.com/photo-1536323760109-ca8c07450053"
                                            width="80" height="60" alt="" style="border-radius: 15px;">
                                        <div class="game-title-header">
                                            <p class="game-title fw-medium text-start color-palette-1 m-0">ruangbelajar SMA/SMK 1 Bulan + Roboguru Plus Premium</p>
                                            <p class="text-xs fw-normal text-start color-palette-2 m-0">Kelas 1 SD</p>
                                        </div>
                                    </th>
                                    <td>
                                        <p class="fw-medium color-palette-1 m-0">Rp 290.000</p>
                                    </td>
                                    <td>
                                        <div>
                                            <span class="float-start icon-status pending"></span>
                                            <p class="fw-medium text-start color-palette-1 m-0 position-relative">
                                                Pending</p>
                                        </div>
                                    </td>
                                    <td>
                                        <a href="../member/transactions-detail.html"
                                            class="btn btn-status rounded-pill text-sm">Details</a>
                                    </td>
                                </tr>
                                <tr data-category="success" class="align-middle">
                                    <th scope="row">
                                        <img class="float-start me-3 mb-lg-0 mb-3" src="https://images.unsplash.com/photo-1536323760109-ca8c07450053"
                                            width="80" height="60" alt="" style="border-radius: 15px;">
                                        <div class="game-title-header">
                                            <p class="game-title fw-medium text-start color-palette-1 m-0">ruangbelajar SMA/SMK 1 Bulan + Roboguru Plus Premium</p>
                                            <p class="text-xs fw-normal text-start color-palette-2 m-0">Kelas 1 SD</p>
                                        </div>
                                    </th>
                                    <td>
                                        <p class="fw-medium color-palette-1 m-0">Rp 740.000</p>
                                    </td>
                                    <td>
                                        <div>
                                            <span class="float-start icon-status success"></span>
                                            <p class="fw-medium text-start color-palette-1 m-0 position-relative">
                                                Success</p>
                                        </div>
                                    </td>
                                    <td>
                                        <a href="../member/transactions-detail.html"
                                            class="btn btn-status rounded-pill text-sm">Details</a>
                                    </td>
                                </tr>
                                <tr data-category="failed" class="align-middle">
                                    <th scope="row">
                                        <img class="float-start me-3 mb-lg-0 mb-3" src="https://images.unsplash.com/photo-1536323760109-ca8c07450053"
                                            width="80" height="60" alt="" style="border-radius: 15px;">
                                        <div class="game-title-header">
                                            <p class="game-title fw-medium text-start color-palette-1 m-0">ruangbelajar SMA/SMK 1 Bulan + Roboguru Plus Premium</p>
                                            <p class="text-xs fw-normal text-start color-palette-2 m-0">Kelas 1 SD</p>
                                        </div>
                                    </th>
                                    <td>
                                        <p class="fw-medium color-palette-1 m-0">Rp 120.000</p>
                                    </td>
                                    <td>
                                        <div>
                                            <span class="float-start icon-status failed"></span>
                                            <p class="fw-medium text-start color-palette-1 m-0 position-relative">Failed
                                            </p>
                                        </div>
                                    </td>
                                    <td>
                                        <a href="../member/transactions-detail.html"
                                            class="btn btn-status rounded-pill text-sm">Details</a>
                                    </td>
                                </tr>
                                <tr data-category="pending" class="align-middle">
                                    <th scope="row">
                                        <img class="float-start me-3 mb-lg-0 mb-3" src="https://images.unsplash.com/photo-1536323760109-ca8c07450053"
                                        width="80" height="60" alt="" style="border-radius: 15px;">
                                        <div class="game-title-header">
                                            <p class="game-title fw-medium text-start color-palette-1 m-0">ruangbelajar SMA/SMK 1 Bulan + Roboguru Plus Premium</p>
                                            <p class="text-xs fw-normal text-start color-palette-2 m-0">Kelas 1 SD</p>
                                        </div>
                                    </th>
                                    <td>
                                        <p class="fw-medium color-palette-1 m-0">Rp 200.000</p>
                                    </td>
                                    <td>
                                        <div>
                                            <span class="float-start icon-status pending"></span>
                                            <p class="fw-medium text-start color-palette-1 m-0 position-relative">
                                                Pending</p>
                                        </div>
                                    </td>
                                    <td>
                                        <a href="../member/transactions-detail.html"
                                            class="btn btn-status rounded-pill text-sm">Details</a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </section>

    <!-- Error Toast -->
    <div id="toast-container" class="toast-container position-fixed bottom-0 end-0 p-3"></div>
    
    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous">
    </script>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script src="../js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if(!getCookie('token') != ""){
                window.location.href = "../src/sign-in.html";
            }
        });

        document.getElementById('keluar-button').addEventListener('click', () =>{
            setCookie('token', '', 0)
        })

        document.addEventListener('DOMContentLoaded', () => {
            reqHeader['Authorization'] = `Bearer ${getCookie('token')}`
            sendGetRequest('/profile', (response) => {
                console.log(response.data.id)
                document.getElementById('user-nama').innerText = response.data.nama
                document.getElementById('user-email').innerText = response.data.email

                sendGetRequest(`/riwayat`, (response) => {
                    document.getElementById('list_status_item').innerHTML = ''
                    for (const data of response.data.reverse()) {
                        document.getElementById('list_status_item').appendChild(transaksiRow(data.id_pembelian, data.nama_paket, data.harga_pembelian, data.status))
                    }
                });

            });
        });

        function transaksiRow(id_pembelian, nama_paket, harga_pembelian, status){
            const node = document.createElement("tr");
            let arrayStatus = [
                "success",
                "failed"
            ]
            node.className += " align-middle "
            if(status == 'Sudah Dibayar'){
                node.setAttribute("data-category", arrayStatus[0]);
            }else{
                node.setAttribute("data-category", arrayStatus[1]);
            }
            node.innerHTML = `
            <th scope="row">
                <img class="float-start me-3 mb-lg-0 mb-3" src="https://images.unsplash.com/photo-1536323760109-ca8c07450053"
                    width="80" height="60" alt="" style="border-radius: 15px;">
                <div class="game-title-header">
                    <p class="game-title fw-medium text-start color-palette-1 m-0">${nama_paket}</p>
                </div>
            </th>
            <td>
                <p class="fw-medium color-palette-1 m-0">${harga_pembelian}</p>
            </td>
            `
            if(status == 'Sudah Dibayar'){
                node.innerHTML += `
                <td>
                    <div>
                        <span class="float-start icon-status success"></span>
                        <p class="fw-medium text-start color-palette-1 m-0 position-relative">
                            ${status}</p>
                    </div>
                </td>
                <td>
                    <a href="../member/transactions-detail.html?id=${id_pembelian}" class="btn btn-status rounded-pill text-sm">Details</a>
                </td>
                `
            }else{
                node.innerHTML += `
                <td>
                    <div>
                        <span class="float-start icon-status failed"></span>
                        <p class="fw-medium text-start color-palette-1 m-0 position-relative">
                            ${status}</p>
                    </div>
                </td>
                `
            }
            return node
        }



        $(document).ready(function () {
            $(".btn-status").click(function () {
                $(this).addClass("btn-active");
                $(".btn-status").not(this).removeClass("btn-active");
            });


            $('#list_status_title a').click(function (event) {
                var filter = $(event.target).attr('data-filter');
                $('#list_status_item tr').each(function () {
                    var item = $(this);
                    console.log(item.attr('data-category').indexOf(filter) != -1);

                    if (filter == '*' || (item.attr('data-category').indexOf(filter) != -1))
                        item.show();
                    else
                        item.hide();
                });
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous">
    </script>
</body>

</html>