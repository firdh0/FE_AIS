<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link rel="icon" type="image/x-icon" href="../assets/logo.png">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/utilities.css" />
    <link rel="stylesheet" href="../css/sidebar.css">
    <link rel="stylesheet" href="../css/transactions-detail.css" />

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet" />

    <title>Detail Transaksi</title>
</head>

<body>
    <div id="loading-effect" class="position-absolute w-100 vh-100">
        <div class="position-absolute top-50 start-50">
            <div class="loader" role="status"></div>
        </div>
    </div>
    <!-- Transactions Detail -->
    <section class="transactions-detail overflow-auto">
        <section class="sidebar">
            <div class="content pt-50 pb-30 ps-30">
                <div class="user text-center pb-50 pe-30">
                    <img src="../assets/img/avatar-1.png" width="90" height="90" class="img-fluid mb-20" />
                    <h2 id="user-nama" class="fw-bold text-xl color-palette-1 m-0"></h2>
                    <p id="user-email" class="color-palette-2 m-0"></p>
                </div>
                <div class="menus">
                    <div class="item active mb-30">
                        <svg class="icon me-3" width="25" height="25" viewBox="0 0 25 25" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M6.90332 2.41406L3.90332 6.41406V20.4141C3.90332 20.9445 4.11403 21.4532 4.48911 21.8283C4.86418 22.2033 5.37289 22.4141 5.90332 22.4141H19.9033C20.4338 22.4141 20.9425 22.2033 21.3175 21.8283C21.6926 21.4532 21.9033 20.9445 21.9033 20.4141V6.41406L18.9033 2.41406H6.90332Z"
                                stroke="#7E8CAC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path
                                d="M16.9033 10.4141C16.9033 11.4749 16.4819 12.4923 15.7317 13.2425C14.9816 13.9926 13.9642 14.4141 12.9033 14.4141C11.8425 14.4141 10.825 13.9926 10.0749 13.2425C9.32475 12.4923 8.90332 11.4749 8.90332 10.4141"
                                stroke="#7E8CAC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M3.90332 6.41406H21.9033" stroke="#7E8CAC" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        <p class="item-title m-0">
                            <a href="../member/riwayat.html" class="text-lg text-decoration-none">Riwayat Pembelian</a>
                        </p>
                    </div>
                    <div class="item mb-30">
                        <svg class="icon me-3" width="25" height="25" viewBox="0 0 25 25" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0)">
                                <path
                                    d="M12.9033 15.4141C16.7693 15.4141 19.9033 12.2801 19.9033 8.41406C19.9033 4.54807 16.7693 1.41406 12.9033 1.41406C9.03733 1.41406 5.90332 4.54807 5.90332 8.41406C5.90332 12.2801 9.03733 15.4141 12.9033 15.4141Z"
                                    stroke="#7E8CAC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <path
                                    d="M9.11332 14.3039L7.90332 23.4139L12.9033 20.4139L17.9033 23.4139L16.6933 14.2939"
                                    stroke="#7E8CAC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </g>
                            <defs>
                                <clipPath id="clip0">
                                    <rect width="24" height="24" fill="white" transform="translate(0.90332 0.414062)" />
                                </clipPath>
                            </defs>
                        </svg>
                        <p class="item-title m-0">
                            <a href="../member/paketsaya.html" class="text-lg text-decoration-none">Paket Saya</a>
                        </p>
                    </div>
                    <div class="item mb-30">
                        <svg class="icon me-3" width="25" height="25" viewBox="0 0 25 25" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0)">
                                <path
                                    d="M12.9033 15.4141C16.7693 15.4141 19.9033 12.2801 19.9033 8.41406C19.9033 4.54807 16.7693 1.41406 12.9033 1.41406C9.03733 1.41406 5.90332 4.54807 5.90332 8.41406C5.90332 12.2801 9.03733 15.4141 12.9033 15.4141Z"
                                    stroke="#7E8CAC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <path
                                    d="M9.11332 14.3039L7.90332 23.4139L12.9033 20.4139L17.9033 23.4139L16.6933 14.2939"
                                    stroke="#7E8CAC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </g>
                            <defs>
                                <clipPath id="clip0">
                                    <rect width="24" height="24" fill="white" transform="translate(0.90332 0.414062)" />
                                </clipPath>
                            </defs>
                        </svg>
                        <p class="item-title m-0">
                            <a href="./belipaket.html" class="text-lg text-decoration-none">Beli Paket</a>
                        </p>
                    </div>
                    <div class="item mb-30">
                        <svg class="icon me-3" width="25" height="25" viewBox="0 0 25 25" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M19.2634 7.05396C20.5218 8.31274 21.3787 9.9164 21.7257 11.6621C22.0728 13.4079 21.8944 15.2173 21.2131 16.8617C20.5318 18.5061 19.3782 19.9115 17.8983 20.9003C16.4183 21.8891 14.6783 22.4169 12.8984 22.4169C11.1185 22.4169 9.37859 21.8891 7.89861 20.9003C6.41864 19.9115 5.26508 18.5061 4.58381 16.8617C3.90253 15.2173 3.72413 13.4079 4.07116 11.6621C4.41819 9.9164 5.27506 8.31274 6.53344 7.05396"
                                stroke="#7E8CAC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M12.9033 2.41406V12.4141" stroke="#7E8CAC" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        <p class="item-title m-0">
                            <a id="keluar-button" href="" class="text-lg text-decoration-none">Log Out</a>
                        </p>
                    </div>
                </div>
            </div>
        </section>
        <main class="main-wrapper">
            <div class="ps-lg-0">
                <h2 class="text-4xl fw-bold color-palette-1 mb-30">Detail Transaksi</h2>
                <div class="details">
                    <div class="main-content main-content-card overflow-auto">
                        <section class="checkout mx-auto">
                            <div class="d-flex flex-row  align-items-center justify-content-between mb-30">
                                <div class="game-checkout d-flex flex-row align-items-center">
                                    <div class="pe-4">
                                        <img class="float-start me-3 mb-lg-0 mb-3" src="https://images.unsplash.com/photo-1536323760109-ca8c07450053"
                                            width="200" height="130" alt="" style="border-radius: 15px;">
                                    </div>
                                    <div>
                                        <p class="fw-bold text-xl color-palette-1 mb-10">ruangbelajar SMA/SMK 1 Bulan + Roboguru Plus Premium</p>
                                        <p class="color-palette-2 m-0">Kelas 1 SD</p>
                                    </div>
                                </div>
                                <div>
                                    <p id="status" class="fw-medium text-center label pending m-0 rounded-pill">Pending</p>
                                </div>
                            </div>
                            <hr>
                            <div class="purchase pt-md-50 pt-30">
                                <h2 class="fw-bold text-xl color-palette-1 mb-20">Detail Pembelian
                                </h2>
                                <p class="text-lg color-palette-1 mb-20">Akun kamu<span id="akunKamu" class="purchase-details">muhammadfirdho4@gmail.com</span></p>
                                <p class="text-lg color-palette-1 mb-20">ID Order <span id="idPembelian" class="purchase-details">#GG001</span></p>
                                <p class="text-lg color-palette-1 mb-20">Harga paket <span id="hargaPaket" class="purchase-details">Rp 42.280.500</span></p>
                                <!-- <p class="text-lg color-palette-1 mb-20">Harga pembelian <span id="hargaPembelian" class="purchase-details">Rp 42.280.500</span></p> -->
                                <!-- <p class="text-lg color-palette-1 mb-20">Promo <span class="purchase-details">-Rp 4.228.000</span> -->
                                </p>
                                <p class="text-lg color-palette-1 mb-20">Total Harga Pembelian <span id="hargaPembelian" class="purchase-details color-palette-4">Rp
                                        55.000.600</span></p>
                            </div>
                            <div class="payment pt-10 pb-10">
                                <h2 class="fw-bold text-xl color-palette-1 mb-20">Informasi Pembayaran</h2>
                                <p class="text-lg color-palette-1 mb-20">Type <span class="payment-details">Bayar</span>
                                </p>
                                <p class="text-lg color-palette-1 mb-20">E-wallet<span
                                        class="payment-details">ShopeePay</span></p>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </main>
    </section>


    <!-- Error Toast -->
    <div id="toast-container" class="toast-container position-fixed bottom-0 end-0 p-3"></div>
    
    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous">
    </script>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script src="../js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if(!getCookie('token') != ""){
                window.location.href = "../src/sign-in.html";
            }
        });

        document.getElementById('keluar-button').addEventListener('click', () =>{
            setCookie('token', '', 0)
        })

        const urlParams = new URLSearchParams(window.location.search);
        const indexTransaksi = urlParams.get('id')

        function addTitik(harga, index){
            if(index >= 4){
                return addTitik(harga.toString().substring(0, index-3) + "." + harga.toString().substring(index-3, harga.length), index-3);
            }else{
                return harga;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            reqHeader['Authorization'] = `Bearer ${getCookie('token')}`
            sendGetRequest('/profile', (response) => {
                document.getElementById('user-nama').innerText = response.data.nama
                document.getElementById('user-email').innerText = response.data.email
                document.getElementById('akunKamu').innerText = response.data.email

                sendGetRequest(`/riwayat/${indexTransaksi}`, (response) => {
                    console.log(response)

                    let _hargaPaket = "Rp " + addTitik((response.data.harga_paket).toString(), (response.data.harga_paket).toString().length);
                    let _hargaPembelian = "Rp " + addTitik((response.data.harga_pembelian).toString(), (response.data.harga_pembelian).toString().length);

                    document.getElementById('idPembelian').innerText = response.data.id_pembelian
                    document.getElementById('hargaPaket').innerText = _hargaPaket
                    document.getElementById('hargaPembelian').innerText = _hargaPembelian

                    if(response.data.status == "Sudah Dibayar"){
                        let status = document.getElementById('status')
                        status.classList.remove("pending");
                        status.classList.add("success");
                        status.innerText = "Sukses"
                    }
                    // for (const data of response.data.reverse()) {
                    //     document.getElementById('list_status_item').appendChild(transaksiRow(data.id_pembelian, data.nama_paket, data.harga_pembelian, data.status))
                    // }
                });

            });
        });
    </script>
    
</body>

</html>